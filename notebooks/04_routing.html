
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Routing optical and RF ports &#8212; gdsfactory 5.12.4 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Routing electrical" href="041_routing_electical.html" />
    <link rel="prev" title="Components with hierarchy" href="04_components_hierarchy.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">gdsfactory 5.12.4 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   gdsfactory 5.12.4
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../git.html">
   Intro Tutorial
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="_0_python.html">
     Python intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_1_git.html">
     Git: Version control intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_2_install.html">
     Install gdsfactory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_2_klayout.html">
     Klayout integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_3_vscode.html">
     VScode
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_4_gdsfactory_in_5minutes.html">
     gdsfactory in 5 minutes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../notebooks.html">
   Layout Tutorial
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="00_geometry.html">
     Component
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01_references.html">
     References and ports
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_movement.html">
     Movement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_cells_autoname_and_cache.html">
     Cell
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_layer_stack.html">
     Layers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_waveguides_paths_crossections.html">
     Path and CrossSection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_components_.html">
     Components
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_components_hierarchy.html">
     Components with hierarchy
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Routing optical and RF ports
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="041_routing_electical.html">
     Routing electrical
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06_yaml_component.html">
     Netlist driven flow (circuits)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07_mask.html">
     Reticle assembly
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08_pdk.html">
     PDK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09_pdk_import.html">
     Import PDK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="common_mistakes.html">
     Common mistakes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../workflow.html">
   Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../components.html">
   Components
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../plugins_mode_solver.html">
   Plugins: Mode solvers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/mpb/001_mpb_waveguide.html">
     MPB mode-solver
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/tidy3d/01_tidy3d_modes.html">
     Tidy3D mode solver
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../plugins_fdtd.html">
   Plugins: FDTD
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/lumerical/1_fdtd_sparameters.html">
     FDTD Lumerical
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/meep/001_meep_sparameters.html">
     FDTD Meep
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/meep/002_gratings.html">
     FDTD Meep gratings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/tidy3d/00_tidy3d.html">
     FDTD tidy3d
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../plugins_circuits.html">
   Plugins: Circuit simulators
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/sax/sax.html">
     SAX circuit simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/simphony/01_components.html">
     Simphony circuit simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="plugins/lumerical/2_interconnect.html">
     Lumerical INTERCONNECT
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contribution.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CHANGELOG.html">
   CHANGELOG
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.Component.html">
     gdsfactory.Component
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.ComponentReference.html">
     gdsfactory.ComponentReference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.read.from_yaml.html">
     gdsfactory.read.from_yaml
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.read.from_np.html">
     gdsfactory.read.from_np
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.read.import_gds.html">
     gdsfactory.read.import_gds
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.path.Path.html">
     gdsfactory.path.Path
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.path.straight.html">
     gdsfactory.path.straight
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.path.euler.html">
     gdsfactory.path.euler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.path.arc.html">
     gdsfactory.path.arc
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.path.spiral_archimedean.html">
     gdsfactory.path.spiral_archimedean
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.path.smooth.html">
     gdsfactory.path.smooth
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.cross_section.html">
     gdsfactory.cross_section.cross_section
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.strip.html">
     gdsfactory.cross_section.strip
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.strip_auto_widen.html">
     gdsfactory.cross_section.strip_auto_widen
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.heater_metal.html">
     gdsfactory.cross_section.heater_metal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.pin.html">
     gdsfactory.cross_section.pin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.pn.html">
     gdsfactory.cross_section.pn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.strip_heater_metal_undercut.html">
     gdsfactory.cross_section.strip_heater_metal_undercut
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.strip_heater_metal.html">
     gdsfactory.cross_section.strip_heater_metal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.strip_heater_doped.html">
     gdsfactory.cross_section.strip_heater_doped
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.rib_heater_doped.html">
     gdsfactory.cross_section.rib_heater_doped
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cross_section.rib_heater_doped_via_stack.html">
     gdsfactory.cross_section.rib_heater_doped_via_stack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.path.transition.html">
     gdsfactory.path.transition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cell.html">
     gdsfactory.cell
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.cell_without_validator.html">
     gdsfactory.cell_without_validator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.types.Layer.html">
     gdsfactory.types.Layer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.types.ComponentSpec.html">
     gdsfactory.types.ComponentSpec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.types.LayerSpec.html">
     gdsfactory.types.LayerSpec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.types.CrossSectionSpec.html">
     gdsfactory.types.CrossSectionSpec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.types.CellSpec.html">
     gdsfactory.types.CellSpec
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../routing.html">
   Routing API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_route.html">
     gdsfactory.routing.get_route
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_route_from_steps.html">
     gdsfactory.routing.get_route_from_steps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.route_quad.html">
     gdsfactory.routing.route_quad
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.route_sharp.html">
     gdsfactory.routing.route_sharp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_bundle.html">
     gdsfactory.routing.get_bundle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_bundle_from_steps.html">
     gdsfactory.routing.get_bundle_from_steps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_bundle_path_length_match.html">
     gdsfactory.routing.get_bundle_path_length_match
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.route_ports_to_side.html">
     gdsfactory.routing.route_ports_to_side
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.route_south.html">
     gdsfactory.routing.route_south
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_routes_bend180.html">
     gdsfactory.routing.get_routes_bend180
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_routes_straight.html">
     gdsfactory.routing.get_routes_straight
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_route_sbend.html">
     gdsfactory.routing.get_route_sbend
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.get_bundle_sbend.html">
     gdsfactory.routing.get_bundle_sbend
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.fanout2x2.html">
     gdsfactory.routing.fanout2x2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.fanout_component.html">
     gdsfactory.routing.fanout_component
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.fanout_ports.html">
     gdsfactory.routing.fanout_ports
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.add_fiber_array.add_fiber_array.html">
     gdsfactory.routing.add_fiber_array.add_fiber_array
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.add_fiber_single.add_fiber_single.html">
     gdsfactory.routing.add_fiber_single.add_fiber_single
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.add_electrical_pads_shortest.html">
     gdsfactory.routing.add_electrical_pads_shortest
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.add_electrical_pads_top.html">
     gdsfactory.routing.add_electrical_pads_top
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_autosummary/gdsfactory.routing.add_electrical_pads_top_dc.html">
     gdsfactory.routing.add_electrical_pads_top_dc
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cli.html">
   Command line interface
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/gdsfactory/gdsfactory"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/gdsfactory/gdsfactory/issues/new?title=Issue%20on%20page%20%2Fnotebooks/04_routing.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/gdsfactory/gdsfactory/edit/master/docs/notebooks/04_routing.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/04_routing.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_route">
   get_route
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#auto_widen">
   auto_widen
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_route_from_waypoints">
   get_route_from_waypoints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_route_from_steps">
   get_route_from_steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_bundle">
   get_bundle
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_bundle_from_waypoints">
   get_bundle_from_waypoints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_bundle_from_steps">
   get_bundle_from_steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_bundle_path_length_match">
   get_bundle_path_length_match
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Add-extra-length">
     Add extra length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#increase-number-of-loops">
     increase number of loops
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Route-to-IO-(Pads,-grating-couplers-...)">
   Route to IO (Pads, grating couplers …)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Route-to-electrical-pads">
     Route to electrical pads
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Route-to-Fiber-Array">
     Route to Fiber Array
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Route-to-fiber-single">
     Route to fiber single
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Routing optical and RF ports</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_route">
   get_route
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#auto_widen">
   auto_widen
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_route_from_waypoints">
   get_route_from_waypoints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_route_from_steps">
   get_route_from_steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_bundle">
   get_bundle
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_bundle_from_waypoints">
   get_bundle_from_waypoints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_bundle_from_steps">
   get_bundle_from_steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get_bundle_path_length_match">
   get_bundle_path_length_match
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Add-extra-length">
     Add extra length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#increase-number-of-loops">
     increase number of loops
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Route-to-IO-(Pads,-grating-couplers-...)">
   Route to IO (Pads, grating couplers …)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Route-to-electrical-pads">
     Route to electrical pads
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Route-to-Fiber-Array">
     Route to Fiber Array
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Route-to-fiber-single">
     Route to fiber single
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Routing-optical-and-RF-ports">
<h1>Routing optical and RF ports<a class="headerlink" href="#Routing-optical-and-RF-ports" title="Permalink to this headline">#</a></h1>
<p>Optical and high speed RF ports have an orientation that routes need to follow to avoid sharp turns that produce reflections.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">gf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set_plot_options</span><span class="p">(</span><span class="n">show_subports</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">gf</span><span class="o">.</span><span class="n">CONF</span><span class="o">.</span><span class="n">plotter</span> <span class="o">=</span> <span class="s2">&quot;matplotlib&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2022-06-30 06:10:04.526 | INFO     | gdsfactory.config:&lt;module&gt;:52 - Load &#39;/home/runner/work/gdsfactory/gdsfactory/gdsfactory&#39; 5.12.4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
<span class="n">mmi1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gdsfactory/gdsfactory/gdsfactory/component.py:1054: UserWarning: Component &#39;Unnamed_65f956be&#39; contains 1 Unnamed cells
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_2_1.png" src="../_images/notebooks_04_routing_2_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
Unnamed_65f956be: uid 0, ports [], aliases [], 0 polygons, 2 references</div>
</div>
<section id="get_route">
<h2>get_route<a class="headerlink" href="#get_route" title="Permalink to this headline">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">get_route</span></code> returns a Manhattan route between 2 ports</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gf.routing.get_route<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;sample_connect&quot;</span><span class="p">)</span>
<span class="n">mmi1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route</span><span class="p">(</span><span class="n">mmi1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">],</span> <span class="n">mmi2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">])</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_5_0.png" src="../_images/notebooks_04_routing_5_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
sample_connect: uid 5, ports [], aliases [], 0 polygons, 7 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">route</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Route(references=[ComponentReference (parent Component &#34;bend_euler&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [69.99   0.625], rotation 0, x_reflection False), ComponentReference (parent Component &#34;bend_euler&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [79.99 40.  ], rotation 90.0, x_reflection True), ComponentReference (parent Component &#34;straight_89bf0bf0&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [15.5    0.625], rotation 0, x_reflection False), ComponentReference (parent Component &#34;straight_7e83a799&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [79.99  10.625], rotation 90.0, x_reflection False), ComponentReference (parent Component &#34;straight_77b336e2&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [89.99 50.  ], rotation 0, x_reflection False)], labels=None, ports=(Port (name o1, midpoint [15.5    0.625], width 0.5, orientation 180, layer (1, 0), port_type optical), Port (name o2, midpoint [90. 50.], width 0.5, orientation 0.0, layer (1, 0), port_type optical)), length=117.149)
</pre></div></div>
</div>
<p><strong>Problem</strong>: get_route with obstacles</p>
<p>sometimes there are obstacles that connect strip does not see!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;sample_problem&quot;</span><span class="p">)</span>
<span class="n">mmi1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">110</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">135</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route</span><span class="p">(</span><span class="n">mmi1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">],</span> <span class="n">mmi2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">])</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_8_0.png" src="../_images/notebooks_04_routing_8_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
sample_problem: uid 15, ports [], aliases [], 0 polygons, 8 references</div>
</div>
<p><strong>Solutions:</strong></p>
<ul class="simple">
<li><p>specify the route waypoints</p></li>
<li><p>specify the route steps</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;sample_avoid_obstacle&quot;</span><span class="p">)</span>
<span class="n">mmi1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">110</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">135</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">x0</span> <span class="o">=</span> <span class="n">mmi1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">mmi1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>


<span class="n">x2</span> <span class="o">=</span> <span class="n">mmi2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">mmi2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>

<span class="n">route</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route_from_waypoints</span><span class="p">(</span>
    <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="mi">40</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="mi">40</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_10_0.png" src="../_images/notebooks_04_routing_10_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
sample_avoid_obstacle: uid 23, ports [], aliases [], 0 polygons, 8 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">route</span><span class="o">.</span><span class="n">length</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
233.274
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">route</span><span class="o">.</span><span class="n">ports</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(Port (name o1, midpoint [15.5   -0.625], width 0.5, orientation 180, layer (1, 0), port_type optical),
 Port (name o2, midpoint [125.5    49.375], width 0.5, orientation 180.0, layer (1, 0), port_type optical))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">route</span><span class="o">.</span><span class="n">references</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ComponentReference (parent Component &#34;bend_euler_44e21782&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [155.5    -0.625], rotation 0, x_reflection False),
 ComponentReference (parent Component &#34;bend_euler_44e21782&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [165.5    39.375], rotation 90, x_reflection False),
 ComponentReference (parent Component &#34;straight_1d269684&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [15.5   -0.625], rotation 0, x_reflection False),
 ComponentReference (parent Component &#34;straight_a1aa286a&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [165.5     9.375], rotation 90.0, x_reflection False),
 ComponentReference (parent Component &#34;straight_a1aa286a&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [155.5    49.375], rotation 180.0, x_reflection False)]
</pre></div></div>
</div>
<p>Lets say that we want to extrude the waveguide using a different waveguide crosssection, for example using a different layer</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;sample_connect&quot;</span><span class="p">)</span>
<span class="n">mmi1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route</span><span class="p">(</span>
    <span class="n">mmi1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">],</span> <span class="n">mmi2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span> <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">metal1</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_15_0.png" src="../_images/notebooks_04_routing_15_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
sample_connect: uid 29, ports [], aliases [], 0 polygons, 7 references</div>
</div>
</section>
<section id="auto_widen">
<h2>auto_widen<a class="headerlink" href="#auto_widen" title="Permalink to this headline">#</a></h2>
<p>To reduce loss and phase errors you can also auto-widen waveguide routes straight sections that are longer than a certain length.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;sample_connect&quot;</span><span class="p">)</span>
<span class="n">mmi1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">mmi2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>

<span class="n">route</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route</span><span class="p">(</span>
    <span class="n">mmi1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">],</span>
    <span class="n">mmi2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span>
    <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span>
    <span class="n">auto_widen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">width_wide</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">auto_widen_minimum_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_17_0.png" src="../_images/notebooks_04_routing_17_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
sample_connect: uid 39, ports [], aliases [], 0 polygons, 9 references</div>
</div>
</section>
<section id="get_route_from_waypoints">
<h2>get_route_from_waypoints<a class="headerlink" href="#get_route_from_waypoints" title="Permalink to this headline">#</a></h2>
<p>Sometimes you need to set up a route with custom waypoints. <code class="docutils literal notranslate"><span class="pre">get_route_from_waypoints</span></code> is a manual version of <code class="docutils literal notranslate"><span class="pre">get_route</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;waypoints_sample&quot;</span><span class="p">)</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight</span><span class="p">()</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
<span class="n">right</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>

<span class="n">obstacle</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">obstacle1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">obstacle</span>
<span class="n">obstacle2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">obstacle</span>
<span class="n">obstacle1</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">obstacle2</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="mi">25</span>


<span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">midpoint</span>
<span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">midpoint</span>
<span class="n">o</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># vertical offset to overcome bottom obstacle</span>
<span class="n">ytop</span> <span class="o">=</span> <span class="mi">20</span>


<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route_from_waypoints</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">),</span>
        <span class="p">(</span><span class="n">p0x</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">p0y</span><span class="p">),</span>
        <span class="p">(</span><span class="n">p0x</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">ytop</span><span class="p">),</span>
        <span class="p">(</span><span class="n">p1x</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">ytop</span><span class="p">),</span>
        <span class="p">(</span><span class="n">p1x</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">p1y</span><span class="p">),</span>
        <span class="p">(</span><span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">routes</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_19_0.png" src="../_images/notebooks_04_routing_19_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
waypoints_sample: uid 49, ports [], aliases [], 0 polygons, 10 references</div>
</div>
</section>
<section id="get_route_from_steps">
<h2>get_route_from_steps<a class="headerlink" href="#get_route_from_steps" title="Permalink to this headline">#</a></h2>
<p>As you can see waypoints can only change one point (x or y) at a time, making the waypoint definition a bit redundant.</p>
<p>You can also use a <code class="docutils literal notranslate"><span class="pre">get_route_from_steps</span></code> which is a more concise route definition, that supports defining only the new steps <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code> together with increments <code class="docutils literal notranslate"><span class="pre">dx</span></code> or <code class="docutils literal notranslate"><span class="pre">dy</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">get_route_from_steps</span></code> is a manual version of <code class="docutils literal notranslate"><span class="pre">get_route</span></code> and a more concise and convenient version of <code class="docutils literal notranslate"><span class="pre">get_route_from_waypoints</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;get_route_from_steps&quot;</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight</span><span class="p">()</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
<span class="n">right</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>

<span class="n">obstacle</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">obstacle1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">obstacle</span>
<span class="n">obstacle2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">obstacle</span>
<span class="n">obstacle1</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">obstacle2</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">port1</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">]</span>
<span class="n">port2</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">]</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route_from_steps</span><span class="p">(</span>
    <span class="n">port1</span><span class="o">=</span><span class="n">port1</span><span class="p">,</span>
    <span class="n">port2</span><span class="o">=</span><span class="n">port2</span><span class="p">,</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">},</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">routes</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_21_0.png" src="../_images/notebooks_04_routing_21_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
get_route_from_steps: uid 60, ports [], aliases [], 0 polygons, 10 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;get_route_from_steps_shorter_syntax&quot;</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight</span><span class="p">()</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
<span class="n">right</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>

<span class="n">obstacle</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">obstacle1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">obstacle</span>
<span class="n">obstacle2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">obstacle</span>
<span class="n">obstacle1</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">obstacle2</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">port1</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">]</span>
<span class="n">port2</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">]</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route_from_steps</span><span class="p">(</span>
    <span class="n">port1</span><span class="o">=</span><span class="n">port1</span><span class="p">,</span>
    <span class="n">port2</span><span class="o">=</span><span class="n">port2</span><span class="p">,</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">},</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">routes</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_22_0.png" src="../_images/notebooks_04_routing_22_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
get_route_from_steps_shorter_syntax: uid 61, ports [], aliases [], 0 polygons, 10 references</div>
</div>
</section>
<section id="get_bundle">
<h2>get_bundle<a class="headerlink" href="#get_bundle" title="Permalink to this headline">#</a></h2>
<p><strong>Problem</strong></p>
<p>See the route collisions When connecting groups of ports using <code class="docutils literal notranslate"><span class="pre">get_route</span></code> manhattan single-route router</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">xs_top</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="mi">127</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs_top</span><span class="p">)</span>
<span class="n">xs_bottom</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">top_ports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs_top</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">bottom_ports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bottom_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs_bottom</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;connect_bundle&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">top_ports</span><span class="p">,</span> <span class="n">bottom_ports</span><span class="p">):</span>
    <span class="n">route</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_route</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_24_0.png" src="../_images/notebooks_04_routing_24_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
connect_bundle: uid 62, ports [], aliases [], 0 polygons, 30 references</div>
</div>
<p><strong>solution</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">get_bundle</span></code> provides you with river routing capabilities, that you can use to route bundles of ports without collisions</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;connect_bundle&quot;</span><span class="p">)</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span><span class="n">top_ports</span><span class="p">,</span> <span class="n">bottom_ports</span><span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_26_0.png" src="../_images/notebooks_04_routing_26_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
connect_bundle: uid 77, ports [], aliases [], 0 polygons, 30 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">ys_right</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="mf">127.0</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ys_right</span><span class="p">)</span>
<span class="n">ys_left</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">right_ports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ys_right</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">left_ports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;L_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="n">ys_left</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># you can also mess up the port order and it will sort them by default</span>
<span class="n">left_ports</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;connect_bundle2&quot;</span><span class="p">)</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
    <span class="n">left_ports</span><span class="p">,</span> <span class="n">right_ports</span><span class="p">,</span> <span class="n">sort_ports</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_straight_length</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_27_0.png" src="../_images/notebooks_04_routing_27_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
connect_bundle2: uid 98, ports [], aliases [], 0 polygons, 30 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs_top</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="mf">127.0</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs_top</span><span class="p">)</span>
<span class="n">xs_bottom</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">top_ports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">xs_top</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">bot_ports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;bot_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">xs_bottom</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">300</span><span class="p">),</span>
        <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">orientation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;connect_bundle&quot;</span><span class="p">)</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
    <span class="n">top_ports</span><span class="p">,</span> <span class="n">bot_ports</span><span class="p">,</span> <span class="n">separation</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">end_straight_length</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_28_0.png" src="../_images/notebooks_04_routing_28_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
connect_bundle: uid 107, ports [], aliases [], 0 polygons, 30 references</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_bundle</span></code> can also route bundles through corners</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>
<span class="kn">from</span> <span class="nn">gdsfactory.cell</span> <span class="kn">import</span> <span class="n">cell</span>
<span class="kn">from</span> <span class="nn">gdsfactory.component</span> <span class="kn">import</span> <span class="n">Component</span>
<span class="kn">from</span> <span class="nn">gdsfactory.port</span> <span class="kn">import</span> <span class="n">Port</span>


<span class="nd">@cell</span>
<span class="k">def</span> <span class="nf">test_connect_corner</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="n">top_cell</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;connect_corner&quot;</span><span class="p">)</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">100.0</span>
        <span class="n">ports_A_TR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A_TR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">a</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_A_TL</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A_TL_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="n">a</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_A_BR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A_BR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_A_BL</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A_BL_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">ports_A_TR</span><span class="p">,</span> <span class="n">ports_A_TL</span><span class="p">,</span> <span class="n">ports_A_BR</span><span class="p">,</span> <span class="n">ports_A_BL</span><span class="p">]</span>

        <span class="n">ports_B_TR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;B_TR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_B_TL</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;B_TL_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">a</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_B_BR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;B_BR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_B_BL</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;B_BL_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">a</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_B</span> <span class="o">=</span> <span class="p">[</span><span class="n">ports_B_TR</span><span class="p">,</span> <span class="n">ports_B_TL</span><span class="p">,</span> <span class="n">ports_B_BR</span><span class="p">,</span> <span class="n">ports_B_BL</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">config</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="n">sep</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">ports_A_TR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A_TR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_A_TL</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A_TL_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_A_BR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A_BR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_A_BL</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A_BL_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">ports_A_TR</span><span class="p">,</span> <span class="n">ports_A_TL</span><span class="p">,</span> <span class="n">ports_A_BR</span><span class="p">,</span> <span class="n">ports_A_BL</span><span class="p">]</span>

        <span class="n">ports_B_TR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;B_TR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_B_TL</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;B_TL_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_B_BR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;B_BR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_B_BL</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;B_BL_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports_B</span> <span class="o">=</span> <span class="p">[</span><span class="n">ports_B_TR</span><span class="p">,</span> <span class="n">ports_B_TL</span><span class="p">,</span> <span class="n">ports_B_BR</span><span class="p">,</span> <span class="n">ports_B_BL</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">config</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ports_A</span><span class="p">,</span> <span class="n">ports_B</span><span class="p">):</span>
            <span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span><span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
                <span class="n">top_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">config</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ports_A</span><span class="p">,</span> <span class="n">ports_B</span><span class="p">):</span>
            <span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span><span class="n">ports2</span><span class="p">,</span> <span class="n">ports1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
                <span class="n">top_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">top_cell</span>


<span class="n">c</span> <span class="o">=</span> <span class="n">test_connect_corner</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_30_0.png" src="../_images/notebooks_04_routing_30_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
test_connect_corner: uid 122, ports [], aliases [], 0 polygons, 72 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">test_connect_corner</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_31_0.png" src="../_images/notebooks_04_routing_31_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
test_connect_corner_configC: uid 137, ports [], aliases [], 0 polygons, 168 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@cell</span>
<span class="k">def</span> <span class="nf">test_connect_bundle_udirect</span><span class="p">(</span><span class="n">dy</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>

    <span class="n">xs1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">]</span>

    <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span> <span class="k">if</span> <span class="n">angle</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;Y&quot;</span>

    <span class="n">pitch</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs1</span><span class="p">)</span>
    <span class="n">xs2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">70</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
        <span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bottom_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">xs2</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bottom_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dy</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="n">top_cell</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;connect_bundle_udirect&quot;</span><span class="p">)</span>
    <span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span><span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
        <span class="n">top_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">top_cell</span>


<span class="n">c</span> <span class="o">=</span> <span class="n">test_connect_bundle_udirect</span><span class="p">()</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_32_0.png" src="../_images/notebooks_04_routing_32_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
test_connect_bundle_udirect: uid 154, ports [], aliases [], 0 polygons, 50 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@cell</span>
<span class="k">def</span> <span class="nf">test_connect_bundle_u_indirect</span><span class="p">(</span><span class="n">dy</span><span class="o">=-</span><span class="mi">200</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="n">xs1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">]</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span> <span class="k">if</span> <span class="n">angle</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;Y&quot;</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs1</span><span class="p">)</span>
    <span class="n">xs2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="n">angle</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">180</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
        <span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

        <span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bot_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">xs2</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

        <span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bot_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dy</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="n">top_cell</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="s2">&quot;connect_bundle_u_indirect&quot;</span><span class="p">)</span>
    <span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
        <span class="n">ports1</span><span class="p">,</span>
        <span class="n">ports2</span><span class="p">,</span>
        <span class="n">bend</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">bend_euler</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
        <span class="n">top_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">top_cell</span>


<span class="n">c</span> <span class="o">=</span> <span class="n">test_connect_bundle_u_indirect</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_33_0.png" src="../_images/notebooks_04_routing_33_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
test_connect_bundle_u_i_d289aeae: uid 197, ports [], aliases [], 0 polygons, 72 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>


<span class="nd">@gf</span><span class="o">.</span><span class="n">cell</span>
<span class="k">def</span> <span class="nf">test_north_to_south</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="mf">200.0</span>
    <span class="n">xs1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">650</span><span class="p">]</span>

    <span class="n">pitch</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs1</span><span class="p">)</span>
    <span class="n">xs2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">xs2</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">400</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)]</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">180</span>

    <span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

    <span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bot_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dy</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
    <span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span><span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span><span class="p">,</span> <span class="n">auto_widen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c</span>


<span class="n">c</span> <span class="o">=</span> <span class="n">test_north_to_south</span><span class="p">()</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_34_0.png" src="../_images/notebooks_04_routing_34_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
test_north_to_south: uid 254, ports [], aliases [], 0 polygons, 60 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">demo_connect_bundle</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;combines all the connect_bundle tests&quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mf">400.0</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="mi">900</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="mf">200.0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;connect_bundle&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">]):</span>
            <span class="n">ci</span> <span class="o">=</span> <span class="n">test_connect_bundle_u_indirect</span><span class="p">(</span><span class="n">dy</span><span class="o">=</span><span class="n">s</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span>
            <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

            <span class="n">ci</span> <span class="o">=</span> <span class="n">test_connect_bundle_udirect</span><span class="p">(</span><span class="n">dy</span><span class="o">=</span><span class="n">s</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">y0</span><span class="p">))</span>
            <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]):</span>
        <span class="n">ci</span> <span class="o">=</span> <span class="n">test_connect_corner</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1700</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c</span>


<span class="n">c</span> <span class="o">=</span> <span class="n">demo_connect_bundle</span><span class="p">()</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_35_0.png" src="../_images/notebooks_04_routing_35_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
connect_bundle: uid 293, ports [], aliases [], 0 polygons, 20 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;route_bend_5um&quot;</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi2x2</span><span class="p">()</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi2x2</span><span class="p">()</span>

<span class="n">c2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
    <span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o4&quot;</span><span class="p">],</span> <span class="n">c1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o3&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="n">c2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o1&quot;</span><span class="p">],</span> <span class="n">c2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;o2&quot;</span><span class="p">]],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_36_0.png" src="../_images/notebooks_04_routing_36_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
route_bend_5um: uid 394, ports [], aliases [], 0 polygons, 12 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;electrical&quot;</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">pad</span><span class="p">()</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">pad</span><span class="p">()</span>
<span class="n">c2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
    <span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;e3&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="n">c2</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;e1&quot;</span><span class="p">]],</span> <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">metal1</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_37_0.png" src="../_images/notebooks_04_routing_37_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
electrical: uid 402, ports [], aliases [], 0 polygons, 7 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;get_bundle_with_ubends_bend_from_top&quot;</span><span class="p">)</span>
<span class="n">pad_array</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">pad_array</span><span class="p">()</span>

<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">pad_array</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">pad_array</span>
<span class="n">c2</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">movex</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span>

<span class="n">routes_bend180</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_routes_bend180</span><span class="p">(</span>
    <span class="n">ports</span><span class="o">=</span><span class="n">c2</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(),</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">75</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">metal1</span><span class="p">,</span>
    <span class="n">bend_port1</span><span class="o">=</span><span class="s2">&quot;e1&quot;</span><span class="p">,</span>
    <span class="n">bend_port2</span><span class="o">=</span><span class="s2">&quot;e2&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">routes_bend180</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(),</span> <span class="n">routes_bend180</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span> <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">metal1</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_38_0.png" src="../_images/notebooks_04_routing_38_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
get_bundle_with_ubends_bend_from_top: uid 411, ports [], aliases [], 0 polygons, 26 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;get_bundle_with_ubends_bend_from_bottom&quot;</span><span class="p">)</span>
<span class="n">pad_array</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">pad_array</span><span class="p">()</span>

<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">pad_array</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">pad_array</span>
<span class="n">c2</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">movex</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span>

<span class="n">routes_bend180</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_routes_bend180</span><span class="p">(</span>
    <span class="n">ports</span><span class="o">=</span><span class="n">c2</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(),</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">75</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">metal1</span><span class="p">,</span>
    <span class="n">bend_port1</span><span class="o">=</span><span class="s2">&quot;e2&quot;</span><span class="p">,</span>
    <span class="n">bend_port2</span><span class="o">=</span><span class="s2">&quot;e1&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">routes_bend180</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(),</span> <span class="n">routes_bend180</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span> <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">metal1</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_39_0.png" src="../_images/notebooks_04_routing_39_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
get_bundle_with_ubends_bend_from_bottom: uid 439, ports [], aliases [], 0 polygons, 26 references</div>
</div>
<p><strong>Problem</strong></p>
<p>Sometimes 90 degrees routes do not have enough space for a Manhattan route</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;route_fail_1&quot;</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">nxn</span><span class="p">(</span><span class="n">east</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">nxn</span><span class="p">(</span><span class="n">west</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_41_0.png" src="../_images/notebooks_04_routing_41_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
route_fail_1: uid 442, ports [], aliases [], 0 polygons, 2 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;route_fail_1&quot;</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">nxn</span><span class="p">(</span><span class="n">east</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">nxn</span><span class="p">(</span><span class="n">west</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">c2</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">),</span>
    <span class="n">auto_widen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_42_0.png" src="../_images/notebooks_04_routing_42_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
route_fail_1: uid 449, ports [], aliases [], 0 polygons, 21 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;route_fail_2&quot;</span><span class="p">)</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">ys_left</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ys_left</span><span class="p">)</span>
<span class="n">ys_right</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">right_ports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ys_right</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">left_ports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="n">ys_left</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">left_ports</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span><span class="n">right_ports</span><span class="p">,</span> <span class="n">left_ports</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_43_0.png" src="../_images/notebooks_04_routing_43_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
route_fail_2: uid 461, ports [], aliases [], 0 polygons, 19 references</div>
</div>
<p><strong>Solution</strong></p>
<p>Add Sbend routes using <code class="docutils literal notranslate"><span class="pre">get_bundle_sbend</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;route_solution_1_get_bundle_sbend&quot;</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">nxn</span><span class="p">(</span><span class="n">east</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">nxn</span><span class="p">(</span><span class="n">west</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_sbend</span><span class="p">(</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">c2</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">routes</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gdsfactory/gdsfactory/gdsfactory/components/bezier.py:99: RuntimeWarning: divide by zero encountered in double_scalars
  min_bend_radius = gf.snap.snap_to_grid(1 / max(np.abs(curv)))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_45_1.png" src="../_images/notebooks_04_routing_45_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
route_solution_1_get_bundle_sbend: uid 468, ports [], aliases [], 0 polygons, 5 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">routes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Routes(references=[ComponentReference (parent Component &#34;bezier_08c93533_bend_s__f3faaa5b&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [8.   1.25], rotation 0, x_reflection False), ComponentReference (parent Component &#34;bezier_6f3b5e6e_bend_s__3daf6097&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [ 8. 10.], rotation 0, x_reflection False), ComponentReference (parent Component &#34;bezier_5a820ac3_bend_s__6f6f9cd6&#34;, ports [&#39;o1&#39;, &#39;o2&#39;], origin [ 8.   18.75], rotation 0, x_reflection False)], lengths=[72.0, 72.354, 73.398], ports=None, bend_radius=[inf, 159.432, 83.82])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;route_solution_2_get_bundle_sbend&quot;</span><span class="p">)</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_sbend</span><span class="p">(</span><span class="n">right_ports</span><span class="p">,</span> <span class="n">left_ports</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="get_bundle_from_waypoints">
<h2>get_bundle_from_waypoints<a class="headerlink" href="#get_bundle_from_waypoints" title="Permalink to this headline">#</a></h2>
<p>While <code class="docutils literal notranslate"><span class="pre">get_bundle</span></code> routes bundles of ports automatically, you can also use <code class="docutils literal notranslate"><span class="pre">get_bundle_from_waypoints</span></code> to manually specify the route waypoints.</p>
<p>You can think of <code class="docutils literal notranslate"><span class="pre">get_bundle_from_waypoints</span></code> as a manual version of <code class="docutils literal notranslate"><span class="pre">get_bundle</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>


<span class="nd">@gf</span><span class="o">.</span><span class="n">cell</span>
<span class="k">def</span> <span class="nf">test_connect_bundle_waypoints</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Connect bundle of ports with bundle of routes following a list of waypoints.&quot;&quot;&quot;</span>
    <span class="n">ys1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.0</span>
    <span class="n">ys2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">120</span><span class="p">])</span> <span class="o">+</span> <span class="mf">500.0</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">ys1</span><span class="o">.</span><span class="n">size</span>

    <span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;A_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ys1</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;B_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">midpoint</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">ys2</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
            <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">p0</span> <span class="o">=</span> <span class="n">ports1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add_ports</span><span class="p">(</span><span class="n">ports1</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add_ports</span><span class="p">(</span><span class="n">ports2</span><span class="p">)</span>
    <span class="n">waypoints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">p0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">p0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">),</span>
        <span class="n">p0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">),</span>
        <span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">400</span><span class="p">,</span> <span class="n">ports2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_from_waypoints</span><span class="p">(</span><span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span><span class="p">,</span> <span class="n">waypoints</span><span class="p">)</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">route</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">routes</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
        <span class="n">lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">length</span>

    <span class="k">return</span> <span class="n">c</span>


<span class="n">cell</span> <span class="o">=</span> <span class="n">test_connect_bundle_waypoints</span><span class="p">()</span>
<span class="n">cell</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_49_0.png" src="../_images/notebooks_04_routing_49_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
test_connect_bundle_waypoints: uid 488, ports ['A_0', 'A_1', 'A_2', 'A_3', 'A_4', 'A_5', 'A_6', 'A_7', 'B_0', 'B_1', 'B_2', 'B_3', 'B_4', 'B_5', 'B_6', 'B_7'], aliases [], 0 polygons, 72 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="n">component</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">r</span><span class="o">.</span><span class="n">movex</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">movey</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>

<span class="n">lt</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">lb</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">lt</span><span class="o">.</span><span class="n">movey</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">ports1</span> <span class="o">=</span> <span class="n">lt</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">lb</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ports2</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>


<span class="n">dx</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">ports1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">midpoint</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">ports1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">midpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">ports2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">midpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">waypoints</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_from_waypoints</span><span class="p">(</span><span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span><span class="p">,</span> <span class="n">waypoints</span><span class="o">=</span><span class="n">waypoints</span><span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gdsfactory/gdsfactory/gdsfactory/component.py:1054: UserWarning: Component &#39;Unnamed_10662395&#39; contains 1 Unnamed cells
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_50_1.png" src="../_images/notebooks_04_routing_50_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
Unnamed_10662395: uid 531, ports [], aliases [], 0 polygons, 13 references</div>
</div>
</section>
<section id="get_bundle_from_steps">
<h2>get_bundle_from_steps<a class="headerlink" href="#get_bundle_from_steps" title="Permalink to this headline">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;get_route_from_steps_sample&quot;</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="n">gf</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">spacing</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">left</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
<span class="n">right</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_from_steps</span><span class="p">(</span>
    <span class="n">p1</span><span class="p">,</span>
    <span class="n">p2</span><span class="p">,</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">}],</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_52_0.png" src="../_images/notebooks_04_routing_52_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
get_route_from_steps_sample: uid 541, ports [], aliases [], 0 polygons, 17 references</div>
</div>
</section>
<section id="get_bundle_path_length_match">
<h2>get_bundle_path_length_match<a class="headerlink" href="#get_bundle_path_length_match" title="Permalink to this headline">#</a></h2>
<p>Sometimes you need to set up a route a bundle of ports that need to keep the same lengths</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;path_length_match_sample&quot;</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="mf">2000.0</span>
<span class="n">xs1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">650</span><span class="p">]</span>

<span class="n">pitch</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs1</span><span class="p">)</span>
<span class="n">xs2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

<span class="n">a1</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">180</span>
<span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bot_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dy</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_path_length_match</span><span class="p">(</span><span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2659.822
2659.822
2659.822
2659.822
2659.822
2659.822
2659.822
2659.822
2659.822
2659.822
2659.822
2659.822
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_54_1.png" src="../_images/notebooks_04_routing_54_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
path_length_match_sample: uid 550, ports [], aliases [], 0 polygons, 130 references</div>
</div>
<section id="Add-extra-length">
<h3>Add extra length<a class="headerlink" href="#Add-extra-length" title="Permalink to this headline">#</a></h3>
<p>You can also add some extra length to all the routes</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;path_length_match_sample&quot;</span><span class="p">)</span>

<span class="n">dy</span> <span class="o">=</span> <span class="mf">2000.0</span>
<span class="n">xs1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">650</span><span class="p">]</span>

<span class="n">pitch</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs1</span><span class="p">)</span>
<span class="n">xs2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

<span class="n">a1</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">180</span>
<span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bot_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dy</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_path_length_match</span><span class="p">(</span><span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span><span class="p">,</span> <span class="n">extra_length</span><span class="o">=</span><span class="mi">44</span><span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2703.822
2703.822
2703.822
2703.822
2703.822
2703.822
2703.822
2703.822
2703.822
2703.822
2703.822
2703.822
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_56_1.png" src="../_images/notebooks_04_routing_56_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
path_length_match_sample: uid 622, ports [], aliases [], 0 polygons, 132 references</div>
</div>
</section>
<section id="increase-number-of-loops">
<h3>increase number of loops<a class="headerlink" href="#increase-number-of-loops" title="Permalink to this headline">#</a></h3>
<p>You can also increase the number of loops</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;path_length_match_sample&quot;</span><span class="p">)</span>

<span class="n">dy</span> <span class="o">=</span> <span class="mf">2000.0</span>
<span class="n">xs1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">650</span><span class="p">]</span>

<span class="n">pitch</span> <span class="o">=</span> <span class="mf">200.0</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs1</span><span class="p">)</span>
<span class="n">xs2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">pitch</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

<span class="n">a1</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">180</span>
<span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">ports1</span> <span class="o">=</span> <span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">ports2</span> <span class="o">=</span> <span class="p">[</span><span class="n">gf</span><span class="o">.</span><span class="n">Port</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bot_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xs2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dy</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_path_length_match</span><span class="p">(</span>
    <span class="n">ports1</span><span class="p">,</span> <span class="n">ports2</span><span class="p">,</span> <span class="n">nb_loops</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">auto_widen</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3586.37
3586.37
3586.37
3586.37
3586.37
3586.37
3586.37
3586.37
3586.37
3586.37
3586.37
3586.37
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_58_1.png" src="../_images/notebooks_04_routing_58_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
path_length_match_sample: uid 689, ports [], aliases [], 0 polygons, 200 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Problem, sometimes when you do path length matching you need to increase the separation</span>
<span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_array</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_array</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">movex</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">c1</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c2</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_path_length_match</span><span class="p">(</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">c2</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">),</span>
    <span class="n">end_straight_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">start_straight_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">separation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gdsfactory/gdsfactory/gdsfactory/component.py:1054: UserWarning: Component &#39;Unnamed_e725d824&#39; contains 1 Unnamed cells
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_59_1.png" src="../_images/notebooks_04_routing_59_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
Unnamed_e725d824: uid 756, ports [], aliases [], 0 polygons, 42 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution: increase separation</span>
<span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_array</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_array</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">movex</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">c1</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c2</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle_path_length_match</span><span class="p">(</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">c2</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">),</span>
    <span class="n">end_straight_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">start_straight_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">separation</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># increased</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gdsfactory/gdsfactory/gdsfactory/component.py:1054: UserWarning: Component &#39;Unnamed_bfcdcb0d&#39; contains 1 Unnamed cells
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_60_1.png" src="../_images/notebooks_04_routing_60_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
Unnamed_bfcdcb0d: uid 774, ports [], aliases [], 0 polygons, 42 references</div>
</div>
</section>
</section>
<section id="Route-to-IO-(Pads,-grating-couplers-...)">
<h2>Route to IO (Pads, grating couplers …)<a class="headerlink" href="#Route-to-IO-(Pads,-grating-couplers-...)" title="Permalink to this headline">#</a></h2>
<section id="Route-to-electrical-pads">
<h3>Route to electrical pads<a class="headerlink" href="#Route-to-electrical-pads" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">mzi</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_heater_metal</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">mzi</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_62_0.png" src="../_images/notebooks_04_routing_62_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
straight_heater_metal_u_3ff09402: uid 787, ports ['o1', 'o2', 'e1', 'e2'], aliases [], 0 polygons, 5 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">mzi</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mzi_phase_shifter</span><span class="p">(</span>
    <span class="n">length_x</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">straight_x_top</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_heater_metal_90_90</span>
<span class="p">)</span>
<span class="n">mzi_te</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_electrical_pads_top</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">mzi</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">mzi_te</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_63_0.png" src="../_images/notebooks_04_routing_63_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mzi_5911ef5e_add_electr_323ad49c: uid 806, ports ['o1', 'o2', 'e2', 'e1'], aliases [], 0 polygons, 4 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">hr</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_heater_metal</span><span class="p">()</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_electrical_pads_shortest</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">hr</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_64_0.png" src="../_images/notebooks_04_routing_64_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
straight_heater_metal_u_7dc7e623: uid 814, ports ['pad1_e1', 'pad1_e2', 'pad1_e3', 'pad1_e4', 'pad1_pad', 'pad2_e1', 'pad2_e2', 'pad2_e3', 'pad2_e4', 'pad2_pad', 'o1', 'o2'], aliases [], 2 polygons, 3 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Problem: Sometimes the shortest path does not work well</span>
<span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mzi_phase_shifter_top_heater_metal</span><span class="p">(</span><span class="n">length_x</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_electrical_pads_shortest</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_65_0.png" src="../_images/notebooks_04_routing_65_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mzi_78bded51_add_electr_1c9fa583: uid 824, ports ['pad1_e1', 'pad1_e2', 'pad1_e3', 'pad1_e4', 'pad1_pad', 'pad2_e1', 'pad2_e2', 'pad2_e3', 'pad2_e4', 'pad2_pad', 'o1', 'o2'], aliases [], 2 polygons, 3 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution: you can use define the pads separate and route metal lines to them</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;mzi_with_pads&quot;</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mzi_phase_shifter_top_heater_metal</span><span class="p">(</span><span class="n">length_x</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">pad_array</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">c2</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">ymax</span> <span class="o">+</span> <span class="mi">20</span>
<span class="n">c2</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c1</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_66_0.png" src="../_images/notebooks_04_routing_66_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mzi_with_pads: uid 827, ports [], aliases [], 0 polygons, 2 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s2">&quot;mzi_with_pads&quot;</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mzi_phase_shifter</span><span class="p">(</span>
    <span class="n">straight_x_top</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">straight_heater_metal_90_90</span><span class="p">,</span> <span class="n">length_x</span><span class="o">=</span><span class="mi">70</span>  <span class="c1"># 150</span>
<span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">pad_array</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>

<span class="n">c2</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">ymax</span> <span class="o">+</span> <span class="mi">30</span>
<span class="n">c2</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c1</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">ports1</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">(</span><span class="n">port_type</span><span class="o">=</span><span class="s2">&quot;electrical&quot;</span><span class="p">)</span>
<span class="n">ports2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">get_ports_list</span><span class="p">()</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">get_bundle</span><span class="p">(</span>
    <span class="n">ports1</span><span class="o">=</span><span class="n">ports1</span><span class="p">,</span>
    <span class="n">ports2</span><span class="o">=</span><span class="n">ports2</span><span class="p">,</span>
    <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">metal1</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">bend</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">wire_corner</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>

<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_67_0.png" src="../_images/notebooks_04_routing_67_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mzi_with_pads: uid 828, ports [], aliases [], 0 polygons, 12 references</div>
</div>
</section>
<section id="Route-to-Fiber-Array">
<h3>Route to Fiber Array<a class="headerlink" href="#Route-to-Fiber-Array" title="Permalink to this headline">#</a></h3>
<p>Routing allows you to define routes to optical or electrical IO (grating couplers or electrical pads)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>
<span class="kn">from</span> <span class="nn">gdsfactory</span> <span class="kn">import</span> <span class="n">LAYER</span>
<span class="kn">from</span> <span class="nn">gdsfactory</span> <span class="kn">import</span> <span class="n">Port</span>


<span class="nd">@gf</span><span class="o">.</span><span class="n">cell</span>
<span class="k">def</span> <span class="nf">big_device</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">port_pitch</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">LAYER</span><span class="o">.</span><span class="n">WG</span><span class="p">,</span> <span class="n">wg_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;big component with N ports on each side&quot;&quot;&quot;</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[[</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">],</span> <span class="p">[</span><span class="n">dx</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">]]</span>
    <span class="n">component</span><span class="o">.</span><span class="n">add_polygon</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span>
    <span class="n">port_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">wg_width</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;W</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">midpoint</span><span class="o">=</span><span class="n">p0</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">port_pitch</span><span class="p">),</span>
            <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
            <span class="o">**</span><span class="n">port_params</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">component</span><span class="o">.</span><span class="n">add_port</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;E</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">midpoint</span><span class="o">=</span><span class="n">p0</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">port_pitch</span><span class="p">),</span>
            <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="o">**</span><span class="n">port_params</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">component</span><span class="o">.</span><span class="n">add_port</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;N</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">midpoint</span><span class="o">=</span><span class="n">p0</span> <span class="o">+</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">port_pitch</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span>
            <span class="n">orientation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
            <span class="o">**</span><span class="n">port_params</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">component</span><span class="o">.</span><span class="n">add_port</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;S</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">midpoint</span><span class="o">=</span><span class="n">p0</span> <span class="o">+</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">port_pitch</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">),</span>
            <span class="n">orientation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span>
            <span class="o">**</span><span class="n">port_params</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">component</span><span class="o">.</span><span class="n">add_port</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">component</span>


<span class="n">component</span> <span class="o">=</span> <span class="n">big_device</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_array</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">fanout_length</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_69_0.png" src="../_images/notebooks_04_routing_69_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
big_device_N10_add_fibe_d3d24951: uid 843, ports ['vertical_te_00', 'vertical_te_01', 'vertical_te_02', 'vertical_te_03', 'vertical_te_04', 'vertical_te_05', 'vertical_te_06', 'vertical_te_07', 'vertical_te_08', 'vertical_te_09', 'vertical_te_010', 'vertical_te_011', 'vertical_te_012', 'vertical_te_013', 'vertical_te_014', 'vertical_te_015', 'vertical_te_016', 'vertical_te_017', 'vertical_te_018', 'vertical_te_019', 'vertical_te_020', 'vertical_te_021', 'vertical_te_022', 'vertical_te_023', 'vertical_te_024', 'vertical_te_025', 'vertical_te_026', 'vertical_te_027', 'vertical_te_028', 'vertical_te_029', 'vertical_te_030', 'vertical_te_031', 'vertical_te_032', 'vertical_te_033', 'vertical_te_034', 'vertical_te_035', 'vertical_te_036', 'vertical_te_037', 'vertical_te_038', 'vertical_te_039', 'vertical_te_10', 'vertical_te_20'], aliases [], 0 polygons, 364 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">ring_double</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_array</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">taper_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_70_0.png" src="../_images/notebooks_04_routing_70_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
ring_double_width0p8_ad_abd73a69: uid 1083, ports ['vertical_te_00', 'vertical_te_01', 'vertical_te_02', 'vertical_te_03', 'vertical_te_10', 'vertical_te_20'], aliases [], 0 polygons, 50 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cc</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
name: ring_double_width0p8_ad_abd73a69
settings:
  changed:
    component:
      name: ring_double_width0p8
      settings:
        changed: &amp;id001
          width: 0.8
        child: null
        default: &amp;id002
          bend: null
          coupler_ring:
            function: coupler_ring
          cross_section:
            function: cross_section
            settings:
              add_bbox:
                function: add_bbox_siepic
              add_pins:
                function: add_pins_siepic
                settings:
                  pin_length: 0.002
              cladding_layers:
              - DEVREC
              cladding_offsets:
              - 0
          gap: 0.2
          length_x: 0.01
          length_y: 0.01
          radius: 10.0
          straight:
            function: straight
        full: &amp;id003
          bend: null
          coupler_ring:
            function: coupler_ring
          cross_section:
            function: cross_section
            settings:
              add_bbox:
                function: add_bbox_siepic
              add_pins:
                function: add_pins_siepic
                settings:
                  pin_length: 0.002
              cladding_layers:
              - DEVREC
              cladding_offsets:
              - 0
          gap: 0.2
          length_x: 0.01
          length_y: 0.01
          radius: 10.0
          straight:
            function: straight
          width: 0.8
        function_name: ring_double
        info: &amp;id004 {}
        info_version: 2
        module: gdsfactory.components.ring_double
        name: ring_double_width0p8
      version: 0.0.1
    taper_length: 150
  child:
    changed:
      width: 0.8
    child: null
    default:
      bend: null
      coupler_ring:
        function: coupler_ring
      cross_section:
        function: cross_section
        settings:
          add_bbox:
            function: add_bbox_siepic
          add_pins:
            function: add_pins_siepic
            settings:
              pin_length: 0.002
          cladding_layers:
          - DEVREC
          cladding_offsets:
          - 0
      gap: 0.2
      length_x: 0.01
      length_y: 0.01
      radius: 10.0
      straight:
        function: straight
    full:
      bend: null
      coupler_ring:
        function: coupler_ring
      cross_section:
        function: cross_section
        settings:
          add_bbox:
            function: add_bbox_siepic
          add_pins:
            function: add_pins_siepic
            settings:
              pin_length: 0.002
          cladding_layers:
          - DEVREC
          cladding_offsets:
          - 0
      gap: 0.2
      length_x: 0.01
      length_y: 0.01
      radius: 10.0
      straight:
        function: straight
      width: 0.8
    function_name: ring_double
    info: {}
    info_version: 2
    module: gdsfactory.components.ring_double
    name: ring_double_width0p8
  default:
    component:
      function: straight
    component_name: null
    cross_section: strip
    gc_port_labels: null
    gc_port_name: o1
    get_input_labels_function:
      function: get_input_labels
    grating_coupler:
      function: grating_coupler_elliptical_trenches
      settings:
        polarization: te
        taper_angle: 35
    layer_label: TEXT
    select_ports:
      function: select_ports
      settings:
        port_type: optical
  full:
    component:
      name: ring_double_width0p8
      settings:
        changed: *id001
        child: null
        default: *id002
        full: *id003
        function_name: ring_double
        info: *id004
        info_version: 2
        module: gdsfactory.components.ring_double
        name: ring_double_width0p8
      version: 0.0.1
    component_name: null
    cross_section: strip
    gc_port_labels: null
    gc_port_name: o1
    get_input_labels_function:
      function: get_input_labels
    grating_coupler:
      function: grating_coupler_elliptical_trenches
      settings:
        polarization: te
        taper_angle: 35
    layer_label: TEXT
    select_ports:
      function: select_ports
      settings:
        port_type: optical
    taper_length: 150
  function_name: add_fiber_array
  info: {}
  info_version: 2
  module: gdsfactory.routing.add_fiber_array
  name: ring_double_width0p8_ad_abd73a69
version: 0.0.1

</pre></div></div>
</div>
<p>You can also mix and match <code class="docutils literal notranslate"><span class="pre">TE</span></code> and <code class="docutils literal notranslate"><span class="pre">TM</span></code> grating couplers</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mzi_phase_shifter</span><span class="p">()</span>
<span class="n">gcte</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">grating_coupler_te</span>
<span class="n">gctm</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">grating_coupler_tm</span>

<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_array</span><span class="p">(</span>
    <span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
    <span class="n">optical_routing_type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">grating_coupler</span><span class="o">=</span><span class="p">[</span><span class="n">gctm</span><span class="p">,</span> <span class="n">gcte</span><span class="p">,</span> <span class="n">gctm</span><span class="p">,</span> <span class="n">gcte</span><span class="p">],</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_73_0.png" src="../_images/notebooks_04_routing_73_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mzi_7a18d033_add_fiber__dd7e8211: uid 1128, ports ['e1', 'e2', 'vertical_tm_00', 'vertical_te_01', 'vertical_tm_10', 'vertical_tm_20'], aliases [], 0 polygons, 32 references</div>
</div>
</section>
<section id="Route-to-fiber-single">
<h3>Route to fiber single<a class="headerlink" href="#Route-to-fiber-single" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">ring_single</span><span class="p">()</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_single</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_75_0.png" src="../_images/notebooks_04_routing_75_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
ring_single_move_fcf2cf_f09ac9e9: uid 1162, ports ['vertical_te_00', 'vertical_te_1', 'loopback1', 'loopback2'], aliases [], 0 polygons, 8 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">ring_single</span><span class="p">()</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_single</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">with_loopback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_76_0.png" src="../_images/notebooks_04_routing_76_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
ring_single_move_fcf2cf_6ec52213: uid 1171, ports ['vertical_te_00', 'vertical_te_1'], aliases [], 0 polygons, 5 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi2x2</span><span class="p">()</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_single</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">with_loopback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_77_0.png" src="../_images/notebooks_04_routing_77_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mmi2x2_move_e93caf81_ad_d2b37ac1: uid 1177, ports ['vertical_te_00', 'vertical_te_01', 'vertical_te_1', 'vertical_te_2'], aliases [], 0 polygons, 25 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_single</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">with_loopback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fiber_spacing</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_78_0.png" src="../_images/notebooks_04_routing_78_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mmi1x2_move_e4219bc5_ad_b073e1da: uid 1189, ports ['vertical_te_00', 'vertical_te_1', 'vertical_te_2'], aliases [], 0 polygons, 15 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">mmi1x2</span><span class="p">()</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_single</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">with_loopback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fiber_spacing</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_79_0.png" src="../_images/notebooks_04_routing_79_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mmi1x2_move_e4219bc5_ad_0bb78b33: uid 1198, ports ['vertical_te_00', 'vertical_te_1', 'vertical_te_2'], aliases [], 0 polygons, 15 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">crossing</span><span class="p">()</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_single</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">with_loopback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_80_0.png" src="../_images/notebooks_04_routing_80_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
crossing_move_5fbb1a97__7c0dc355: uid 1209, ports ['vertical_te_00', 'vertical_te_1', 'vertical_te_2', 'vertical_te_3'], aliases [], 0 polygons, 23 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">port_type</span><span class="o">=</span><span class="s2">&quot;optical&quot;</span><span class="p">)</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_single</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">with_loopback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_81_0.png" src="../_images/notebooks_04_routing_81_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
cross_9bc31ebd_move_785_d5bc1aa6: uid 1228, ports ['vertical_te_00', 'vertical_te_1', 'vertical_te_2', 'vertical_te_3'], aliases [], 0 polygons, 23 references</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">spiral</span><span class="p">()</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">add_fiber_single</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">with_loopback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cc</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_04_routing_82_0.png" src="../_images/notebooks_04_routing_82_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
spiral_move_ce1b812e_ad_d80b515b: uid 1245, ports ['vertical_te_0', 'vertical_te_1'], aliases [], 0 polygons, 3 references</div>
</div>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="04_components_hierarchy.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Components with hierarchy</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="041_routing_electical.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Routing electrical</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>